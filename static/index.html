<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnergyApp LLM Chat</title>
  <link rel="icon" type="image/png" href="/static/favicon.png" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <div class="brand">
      <img src="/static/logo.png" alt="logo" />
    </div>
    <div class="nav-actions">
      <button class="icon-btn" title="Config" onclick="setTab('config')">⚙</button>
    </div>
  </header>

  <main id="layout" class="unauth">
    <aside>
      <div id="loginBlock" class="block">
        <div class="logo-wrapper" style="margin-bottom:16px; display:flex; justify-content:center;">
          <img src="/static/logo.png" alt="logo" style="height:60px;" />
        </div>
        <label for="email">Email</label>
        <input id="email" type="email" value="administrador@alvaradomazzei.cl" />
        <label for="password" style="margin-top:8px;">Password</label>
        <input id="password" type="password" value="admin123" />
        <button id="btnLogin" style="margin-top:12px; width:100%;">Login</button>

        <div class="muted" style="margin:12px 0 8px; font-weight:bold;">Acceso rápido</div>
        <div class="row-flex" style="gap:6px;">
          <button id="btnFillAdmin" class="ghost" style="flex:1; font-size:12px;">Admin</button>
          <button id="btnFillWorker" class="ghost" style="flex:1; font-size:12px;">Trabajador</button>
          <button id="btnFillSupervisor" class="ghost" style="flex:1; font-size:12px;">Supervisor</button>
        </div>

        <button id="btnRegister" class="ghost" style="margin-top:8px; width:100%; font-size:12px;">Registro</button>
        <p id="loginStatus" class="muted" style="margin-top:8px; font-size:11px;"></p>
      </div>

      <div id="qrBlock" class="hidden" style="width:280px;">
        <div style="text-align:center;">
          <div style="background:rgba(255,152,0,0.1); border:1px solid #ff9800; border-radius:4px; padding:8px; margin-bottom:12px;">
            <p style="margin:0; font-size:12px; color:#ff9800; font-weight:bold;">Credencial de Demo</p>
            <p style="margin:4px 0 0 0; font-size:10px; color:#ff9800; line-height:1.4;">Escanea para autenticarte con una cuenta de prueba</p>
          </div>
          <div id="qrDisplayContainer" style="display:flex; align-items:center; justify-content:center; width:280px; height:280px; padding:8px;">
            <div class="muted" style="font-size:11px;">Cargando QR...</div>
          </div>
          <div id="qrSecretDisplay" style="font-size:8px; font-family:monospace; word-break:break-all; padding:6px; background:var(--bg); border-radius:2px; margin-top:8px; max-height:50px; overflow-y:auto; display:none; border:1px solid var(--border); line-height:1.2;"></div>
        </div>
      </div>

      <div id="twoFAFormBlock" class="block hidden">
        <div style="text-align: center; margin-bottom: 16px;">
          <h3 style="margin: 0 0 8px;">Verificación 2FA</h3>
          <p class="muted" style="margin: 0;">Ingresa el código de tu app autenticadora</p>
        </div>
        <input id="totpCode" type="text" placeholder="000000" maxlength="6" inputmode="numeric" style="text-align: center; font-size: 24px; letter-spacing: 8px;" />
        <button id="btnVerify2FA" style="margin-top: 12px;">Verificar</button>
        <button id="btnCancel2FA" class="ghost" style="margin-top: 6px;">Cancelar</button>
        <p id="twoFAStatus" class="muted" style="margin-top: 6px;"></p>
      </div>

      <div id="convBlock" class="block hidden full-height">
        <button id="btnNewConv" style="margin-bottom:8px;">Nueva conversacion</button>
        <div class="muted" style="margin-bottom:6px;">Conversaciones recientes</div>
        <div class="conv-list" id="convList"></div>
        <div class="conv-footer" style="border-top:1px solid var(--border); padding-top:8px; margin-top:8px; flex-shrink:0;">
          <div class="muted" id="userInfo"></div>
          <button id="btnAdmin" class="ghost" style="margin-top:8px;">Perfil / Admin</button>
          <button id="btnLogout" class="ghost" style="margin-top:6px;">Logout</button>
        </div>
      </div>
    </aside>

    <section class="content hidden" id="contentShell">
      <div class="tabs" id="tabs">
        <button data-tab="chat" class="active">Chat</button>
        <button data-tab="config">Config</button>
        <button data-tab="admin">Admin</button>
      </div>

      <div id="chatShell" class="section active">
        <div class="chat-header" id="convTitle">Nueva conversacion</div>
        <div class="chat-box" id="chatBox"></div>
        <div class="prompt-area">
          <label for="prompt" class="muted">Prompt</label>
          <textarea id="prompt" placeholder="Escribe tu mensaje...">Hola, ¿qué puedes hacer?</textarea>
          <div class="row">
            <button id="btnSend" style="flex:1">Enviar</button>
            <button id="btnClear" class="ghost" style="width:140px; display:flex; align-items:center; justify-content:center; gap:6px;">🧹 Limpiar</button>
          </div>
          <div id="status" class="status"></div>
        </div>
      </div>

      <div id="configShell" class="section hidden">
        <div class="block">
          <h3 style="margin:0 0 6px;">Perfil</h3>
          <p class="muted" id="profileInfo">Email / rol</p>
          <div class="row-flex">
            <input id="currentPassword" type="password" placeholder="Contraseña actual" />
            <input id="newPassword" type="password" placeholder="Nueva contraseña" />
            <input id="confirmPassword" type="password" placeholder="Confirmar" />
          </div>
          <button id="btnChangePassword" style="margin-top:8px;">Cambiar contraseña</button>
          <p class="muted" id="pwStatus"></p>
        </div>
        <div class="block">
          <h3 style="margin:0 0 6px;">Configuración de modelo</h3>
          <div class="row-flex">
            <input id="cfgModel" placeholder="Modelo" />
            <input id="cfgHost" placeholder="Host Ollama" />
          </div>
          <div class="row-flex">
            <input id="cfgTemp" placeholder="temperature" />
            <input id="cfgTopP" placeholder="top_p" />
            <input id="cfgMaxTokens" placeholder="max_tokens" />
          </div>
          <div class="row-flex" style="align-items:center;">
            <button id="btnPingOllama" style="flex:1;">Probar conexión Ollama</button>
            <p class="muted" id="ollamaStatus" style="margin:0 0 0 8px;"></p>
          </div>
        </div>
      </div>

      <div id="adminShell" class="section hidden">
        <div class="block admin-container admin-users-block">
          <div class="muted">Usuarios</div>
          <div id="adminUserList" class="admin-list" style="min-height:120px;">
            <div class="muted">Cargando usuarios...</div>
          </div>
        </div>
        <div class="block admin-container" style="flex:1;">
          <div class="row admin-top">
            <div>
              <div class="muted">Conversaciones de usuario</div>
              <div id="adminUserSelected" class="muted">Selecciona un usuario</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
              <select id="reassignSelect" class="select-control" style="width:220px;"></select>
              <button id="btnReassign" style="width:140px;">Reasignar</button>
            </div>
          </div>
          <div class="row admin-bottom">
            <div id="adminConvList" class="conv-list admin-conv-list">
              <div class="muted">Selecciona un usuario</div>
            </div>
            <div class="admin-message-pane">
              <div class="muted" id="adminConvTitle">Selecciona una conversación</div>
              <div class="chat-box admin-messages" id="adminMessages">
                <div class="welcome">Sin mensajes</div>
              </div>
            </div>
          </div>
          <div class="status" id="adminStatus"></div>
        </div>
      </div>
    </section>
  </main>

  <script type="module" src="/static/app.js"></script>
</body>
</html>
