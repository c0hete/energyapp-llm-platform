<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnergyApp LLM Chat</title>
  <link rel="icon" type="image/png" href="/static/favicon.png" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <div class="brand">
      <img src="/static/logo.png" alt="logo" />
    </div>
    <div class="nav-actions">
      <button class="icon-btn" title="Config" onclick="setTab('config')">‚öô</button>
    </div>
  </header>

  <main id="layout" class="unauth">
    <aside>
      <div id="loginBlock" class="block">
        <div class="logo-wrapper">
          <img src="/static/logo.png" alt="logo" />
        </div>
        <label for="email">Email</label>
        <input id="email" type="email" value="admin@example.com" />
        <label for="password">Password</label>
        <input id="password" type="password" value="admin123" />
        <button id="btnLogin" style="margin-top:8px;">Login</button>
        <div class="muted" style="margin:10px 0 6px;">Acceso r√°pido</div>
        <div class="row-flex">
          <button id="btnFillAdmin" class="ghost" style="flex:1;">Admin</button>
          <button id="btnFillWorker" class="ghost" style="flex:1;">Trabajador</button>
          <button id="btnFillSupervisor" class="ghost" style="flex:1;">Supervisor</button>
        </div>
        <button id="btnDemoAdmin" class="ghost" style="margin-top:6px;">Login demo (admin)</button>
        <p id="loginStatus" class="muted" style="margin-top:6px;"></p>
      </div>
      <div id="convBlock" class="block hidden full-height">
        <button id="btnNewConv" style="margin-bottom:8px;">Nueva conversacion</button>
        <div class="muted" style="margin-bottom:6px;">Conversaciones recientes</div>
        <div class="conv-list" id="convList"></div>
        <div class="conv-footer" style="border-top:1px solid var(--border); padding-top:8px; margin-top:8px; flex-shrink:0;">
          <div class="muted" id="userInfo"></div>
          <button id="btnAdmin" class="ghost" style="margin-top:8px;">Perfil / Admin</button>
          <button id="btnLogout" class="ghost" style="margin-top:6px;">Logout</button>
        </div>
      </div>
    </aside>

    <section class="content hidden" id="contentShell">
      <div class="tabs" id="tabs">
        <button data-tab="chat" class="active">Chat</button>
        <button data-tab="config">Config</button>
        <button data-tab="admin">Admin</button>
      </div>

      <div id="chatShell" class="section active">
        <div class="chat-header" id="convTitle">Nueva conversacion</div>
        <div class="chat-box" id="chatBox"></div>
        <div class="prompt-area">
          <label for="prompt" class="muted">Prompt</label>
          <textarea id="prompt" placeholder="Escribe tu mensaje...">Hola, ¬øqu√© puedes hacer?</textarea>
          <div class="row">
            <button id="btnSend" style="flex:1">Enviar</button>
            <button id="btnClear" class="ghost" style="width:140px; display:flex; align-items:center; justify-content:center; gap:6px;">üßπ Limpiar</button>
          </div>
          <div id="status" class="status"></div>
        </div>
      </div>

      <div id="configShell" class="section hidden">
        <div class="block">
          <h3 style="margin:0 0 6px;">Perfil</h3>
          <p class="muted" id="profileInfo">Email / rol</p>
          <div class="row-flex">
            <input id="currentPassword" type="password" placeholder="Contrase√±a actual" />
            <input id="newPassword" type="password" placeholder="Nueva contrase√±a" />
            <input id="confirmPassword" type="password" placeholder="Confirmar" />
          </div>
          <button id="btnChangePassword" style="margin-top:8px;">Cambiar contrase√±a</button>
          <p class="muted" id="pwStatus"></p>
        </div>
        <div class="block">
          <h3 style="margin:0 0 6px;">Configuraci√≥n de modelo</h3>
          <div class="row-flex">
            <input id="cfgModel" placeholder="Modelo" />
            <input id="cfgHost" placeholder="Host Ollama" />
          </div>
          <div class="row-flex">
            <input id="cfgTemp" placeholder="temperature" />
            <input id="cfgTopP" placeholder="top_p" />
            <input id="cfgMaxTokens" placeholder="max_tokens" />
          </div>
          <div class="row-flex" style="align-items:center;">
            <button id="btnPingOllama" style="flex:1;">Probar conexi√≥n Ollama</button>
            <p class="muted" id="ollamaStatus" style="margin:0 0 0 8px;"></p>
          </div>
        </div>
      </div>

      <div id="adminShell" class="section hidden">
        <div class="block admin-container admin-users-block">
          <div class="muted">Usuarios</div>
          <div id="adminUserList" class="admin-list" style="min-height:120px;">
            <div class="muted">Cargando usuarios...</div>
          </div>
        </div>
        <div class="block admin-container" style="flex:1;">
          <div class="row admin-top">
            <div>
              <div class="muted">Conversaciones de usuario</div>
              <div id="adminUserSelected" class="muted">Selecciona un usuario</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
              <input id="reassignEmail" placeholder="Reasignar a email" style="width:210px;" />
              <button id="btnReassign" style="width:140px;">Reasignar</button>
            </div>
          </div>
          <div class="row admin-bottom">
            <div id="adminConvList" class="conv-list admin-conv-list">
              <div class="muted">Selecciona un usuario</div>
            </div>
            <div class="admin-message-pane">
              <div class="muted" id="adminConvTitle">Selecciona una conversaci√≥n</div>
              <div class="chat-box admin-messages" id="adminMessages">
                <div class="welcome">Sin mensajes</div>
              </div>
            </div>
          </div>
          <div class="status" id="adminStatus"></div>
        </div>
      </div>
    </section>
  </main>

  <script type="module" src="/static/app.js"></script>
</body>
</html>
